<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <!-- A√±adido id para cambiar din√°micamente si fuera necesario -->
  <meta name="viewport" id="viewport-meta" content="width=device-width, initial-scale=1">
  <title>Archinime</title>

  <link rel="icon" href="Logo_Archinime.png" type="image/png">

  <!-- Preload del video y poster para mejorar la percepci√≥n de carga -->
  <link rel="preload" as="video" href="galaxia.mp4" type="video/mp4">
  <link rel="preload" as="image" href="galaxia-poster.jpg">

  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{
      height:100%;
      overflow-x:hidden;
      overflow-y:auto;
      font-family:sans-serif;
      color:#fff;
    }

    /* Fondo galaxia
       - video debe estar detr√°s de todo (-2)
       - overlay ocupa la parte superior (-1) mientras carga y luego se oculta (display:none)
    */
    #bg-video{
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-2;                  /* detr√°s del overlay y dem√°s */
      will-change: opacity, transform;
      opacity:0;                   /* oculto hasta que est√© listo */
      transition:opacity .6s ease;
      background:#000;             /* color de fallback mientras se carga */
      pointer-events:none;
    }

    #overlay{
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      z-index:-1;                  /* encima del video al inicio */
      will-change: background, opacity;
      background: url('galaxia-poster.jpg') center/cover no-repeat,
                  linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.6));
      opacity:1;
      transition:opacity .6s ease;
      pointer-events:none;         /* no bloquear clicks que necesiten autoplay */
    }

    /* Bot√≥n circular de apoyo */
    #support {
      position: fixed; bottom:1rem; right:1rem;
      text-align:center; z-index:11;
    }
    #tiktok-btn, #youtube-btn {
      width:60px; height:60px; border:none;
      border-radius:50%; background:#fff;
      padding:0; cursor:pointer;
      box-shadow:0 2px 8px rgba(0,0,0,0.5);
      transition:transform .2s; overflow:hidden;
    }
    #tiktok-btn:hover, #youtube-btn:hover { transform:scale(1.1); }
    #tiktok-btn img, #youtube-btn img { width:100%;height:100%;object-fit:cover; }
    #support-text{
      margin-top:.4rem; font-size:.9rem;
      color:#0ff; text-shadow:1px 1px 2px #000;
      font-weight:bold; white-space:nowrap;
    }

    /* Header */
    header{
      position:sticky; top:0; padding:1rem 2rem;
      display:flex; align-items:center; gap:1rem;
      background:rgba(0,0,0,0.7); backdrop-filter:blur(5px);
      z-index:10; transition:background .3s;
      /* permitimos que otros elementos puedan envolver, pero protegeremos el t√≠tulo */
      flex-wrap:wrap;
    }
    header.scrolled{background:rgba(0,0,0,0.95);}
    /* T√≠tulo + logo: forzar que se mantengan en la misma l√≠nea siempre */
    header h1{
      cursor:pointer; 
      font-size:1.8rem;
      font-weight: 800;

      background: linear-gradient(135deg, #00fff7, #ff00cc, #ffd700);
      background-size:300% 300%;
      -webkit-background-clip:text; 
      background-clip:text;
      -webkit-text-fill-color:transparent;
      display:flex; align-items:center; gap:.6rem;
      flex:0 0 auto;             /* evita que el h1 se reduzca/encole o salte a otra l√≠nea */
      white-space:nowrap;        /* evita el quiebre de l√≠nea entre logo y texto */
      animation: gradientMove 6s ease infinite, fadeIn 2s ease-in-out;
    }

    /* Logo peque√±o al lado del t√≠tulo */
    header h1 img#logo {
      width:42px;
      height:42px;
      object-fit:contain;
      border-radius:6px;
      background:transparent;
      display:block;
      flex:0 0 auto;
    }
    header h1 img#logo {
      width:42px;
      height:42px;
      object-fit:contain;
      border-radius:6px;
      background:transparent;
      display:block;
    }
    header select, header input{
      padding:.5rem 1rem; border:none; border-radius:5px;
      font-size:1rem; transition:box-shadow .3s;
      background:rgba(255,255,255,0.9); color:#000;
    }
    header select:focus, header input:focus{
      box-shadow:0 0 8px #0ff;
    }
    #search{width:200px;}
    .container{max-width:1200px;margin:6rem auto 2rem;padding:0 2rem;}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1.5rem;}
    .card{
      opacity:0; transform:translateY(30px);
      transition:all .6s ease-out; cursor:pointer;
      border-radius:10px; overflow:hidden; position:relative;
      will-change: opacity, transform;
    }
    .card.visible{opacity:1;transform:translateY(0);}
    .card img{
      width:100%; display:block;
      filter:brightness(100%);
      transition:transform .4s,filter .4s;
    }
    .card:hover img{
      transform:scale(1.05); filter:brightness(75%);
    }
    .info{
      position:absolute; bottom:0; left:0; right:0;
      background:rgba(0,0,0,0.7); padding:.75rem;
      transform:translateY(100%); transition:transform .3s;
    }
    .card:hover .info{transform:translateY(0);}
    .info strong{display:block;font-size:1.05rem;margin-bottom:.25rem;}
    .info span{
      background:#0ff; color:#000;
      padding:2px 6px; border-radius:4px; font-size:.85rem;
    }

    /* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Media query para m√≥viles (‚â§600px) ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
    @media (max-width: 600px) {
      header {
        flex-wrap: wrap;
        padding: 0.5rem 1rem;
        gap: 0.5rem;
        justify-content: center;
      }
      header select, header input#search,
      #genre-select, #rating-select {
        flex: 1 1 100%;
        max-width: 100%;
        padding: 0.4rem;
        font-size: 0.9rem;
      }
      #support {
        display: flex; flex-direction: column; align-items: center;
      }
      #tiktok-btn, #youtube-btn {
        width: 50px; height: 50px; margin: 0.3rem 0;
      }
      #support-text {
        font-size: 0.75rem; text-align: center;
      }
    }

    /* Animaci√≥n del gradiente para el t√≠tulo (Archinime) */
    @keyframes gradientMove {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
  </style>
</head>
<body>

  <!-- V√≠deo de fondo -->
<video id="bg-video" autoplay muted loop playsinline>
    <source src="galaxia.mp4" type="video/mp4">
  </video>
  <div id="overlay"></div>

  <audio id="bg-music" autoplay>
    <source src="https://www.dropbox.com/scl/fi/k85eln5jkukzgw8auarsh/Yo-y-los-que-tuvieron-etapa-Vocaloid-cuando-suena.mp3?rlkey=kpl5z8pbl6gz3w4ob3b8lx3sl&st=90mh5kmo&raw=1" type="audio/mpeg">
    Tu navegador no soporta el audio.
  </audio>

  <!-- Botones circulares de apoyo (ahora usan JS para abrir en nueva ventana/pesta√±a) -->
  <div id="support">
    <button id="youtube-btn" type="button" aria-label="Abrir YouTube en nueva pesta√±a"
            onclick="openInNewTab('https://www.youtube.com/@Archinime-k2g')">
      <img src="youtube.jpg" alt="YouTube">
    </button>

    <button id="tiktok-btn" type="button" aria-label="Abrir TikTok en nueva pesta√±a"
            onclick="openInNewTab('https://www.tiktok.com/@archinime?_t=ZS-8zGoKE4IqLw&_r=1')">
      <img src="tiktok.jpg" alt="TikTok">
    </button>

    <div id="support-text">Sugi√©reme un anime üëÜ</div>
  </div>

  <header>
    <h1 onclick="location.reload()">
      <img id="logo" src="Logo_Archinime.png" alt="Logo Archinime">
      Archinime
    </h1>

    <select id="genre-select" onchange="filtro()">
      <option value="">Todos los g√©neros</option>
<option>Acci√≥n</option>
<option>Animaci√≥n</option>
<option>Aventura</option>
<option>Ciencia ficci√≥n</option>
<option>Comedia</option>
<option>Comedia oscura</option>
<option>Crimen</option>
<option>Cyberpunk</option>
<option>Deportivo</option>
<option>Dibujo Animado</option>
<option>Divulgaci√≥n Cient√≠fica</option>
<option>Drama</option>
<option>Ecchi</option>
<option>Escolar</option>
<option>Fantas√≠a</option>
<option>Fantas√≠a oscura</option>
<option>Familiar</option>
<option>Gore</option>
<option>Harem</option>
<option>Hentai</option>
<option>Hist√≥rico</option>
<option>Horror</option>
<option>Incesto</option>
<option>Infantil</option>
<option>Isekai</option>
<option>Isekai Inverso</option>
<option>Josei</option>
<option>Kaiju</option>
<option>Kodomo</option>
<option>Mah≈ç Sh≈çjo</option>
<option>Mecha</option>
<option>Militar</option>
<option>Misterio</option>
<option>Musical</option>
<option>Nekketsu</option>
<option>Parodia</option>
<option>Post-apocal√≠ptico</option>
<option>Psicol√≥gico</option>
<option>Reverse Harem</option>
<option>Romance</option>
<option>Romance escolar</option>
<option>Seinen</option>
<option>Sh≈çjo</option>
<option>Sh≈çnen</option>
<option>Slice of Life</option>
<option>Sobrenatural</option>
<option>Superh√©roes</option>
<option>Tent√°culos</option>
<option>Terror</option>
<option>Terror psicol√≥gico</option>
<option>Thriller</option>
<option>Thriller psicol√≥gico</option>
<option>Tragedia</option>
<option>Yaoi</option>
<option>Yuri</option>
    </select>

    <select id="rating-select" onchange="filtro()">
      <option value="">‚≠ê Todas</option>
      <option value="excellent">‚≠ê Excelente (4.8‚Äì5.0)</option>
      <option value="good">‚≠ê Buena (4.6‚Äì4.7)</option>
      <option value="regular">‚≠ê Regular (&lt;4.5)</option>
    </select>

    <input id="search" placeholder="üîç Buscar anime‚Ä¶" oninput="debouncedFiltro()">
  </header>

  <main class="container">
    <div class="grid" id="grid"></div>
  </main>

  <script>
    // ---- Manejo del video de fondo: mostrar poster mientras carga y revelar el video al estar listo ----
    window.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('bg-video');
      const overlay = document.getElementById('overlay');

      // Seguridad: atributos esenciales
      try { video.preload = video.getAttribute('preload') || 'auto'; } catch(e){ console.warn(e); }
      video.muted = true;
      video.playsInline = true;

      // funci√≥n que revela el video y oculta el overlay (con transici√≥n)
      const revealVideo = () => {
        // mostrar video
        video.style.opacity = '1';
        // ocultar overlay suavemente
        overlay.style.opacity = '0';
      };

      // cuando la transici√≥n de overlay termine y est√© en 0, lo quitamos del flujo (display:none)
      overlay.addEventListener('transitionend', (ev) => {
        if (ev.propertyName === 'opacity' && getComputedStyle(overlay).opacity === '0') {
          overlay.style.display = 'none';
        }
      });

      // Si el navegador indica que puede reproducir sin parar (buffer OK)
      video.addEventListener('canplaythrough', () => {
        setTimeout(() => {
          revealVideo();
          // Intentar play (algunos navegadores requieren llamada expl√≠cita)
          video.play().catch(() => {
            // No hacemos nada, el fallback de abajo pedir√° click si es necesario
          });
        }, 80);
      }, { once: true });

      // Fallback: cuando haya datos cargados (menos estricto)
      video.addEventListener('loadeddata', () => {
        if (video.readyState >= 2) {
          setTimeout(() => {
            revealVideo();
            video.play().catch(() => {});
          }, 150);
        }
      }, { once: true });

      // Fallback temporal: si despu√©s de X ms sigue sin buffer suficiente, mostramos video (aunque overlay puede permanecer visible)
      setTimeout(() => {
        // Si no logr√≥ canplaythrough, forzamos mostrar el video (mejor que pantalla negra)
        if (video.readyState < 3) {
          // mostrar video y dejar overlay (se ocultar√° si el usuario tiene conexi√≥n y pronto puede)
          try {
            video.style.opacity = '1';
            overlay.style.opacity = '0';
            video.play().catch(() => {
              // si autoplay falla, dejamos poster visible (display none ya ser√° aplicado si opacity=0 y transitionend dispara)
            });
          } catch(e) {
            console.warn('Fallback de video fallo:', e);
          }
        }
      }, 3500);

      // Reintentos: si play fue bloqueado por pol√≠tica, intentaremos reproducir al primer click del usuario
      video.play().catch(() => {
        document.addEventListener('click', function tryPlay() {
          video.play().catch(() => {});
          // tambi√©n ocultamos overlay en caso de que el click sea la se√±al del usuario
          revealVideo();
          document.removeEventListener('click', tryPlay);
        }, { once: true });
      });
    });

    // ---- Audio autoplay robusto ----
    window.addEventListener('DOMContentLoaded', () => {
      const audio = document.getElementById('bg-music');
      try { audio.loop = true; } catch(e){ console.warn(e); }
      audio.volume = 0.8;
      audio.play().catch(() => {
        // si autoplay es bloqueado, reproducir al primer click
        document.addEventListener('click', () => { audio.play().catch(()=>{}); }, { once: true });
      });
      audio.addEventListener('ended', () => {
        try { audio.currentTime = 0; audio.play(); } catch (e) { console.warn(e); }
      });
    });

    // Abre en nueva pesta√±a/ventana
    function openInNewTab(url) {
      const win = window.open(url, '_blank', 'noopener,noreferrer');
      try { setTimeout(() => { if (typeof window.focus === 'function') window.focus(); }, 100); } catch(e){ console.warn(e); }
      return win;
    }

    // Normaliza texto (quita tildes y pasa a min√∫sculas)
    function normalizeText(s) {
      return String(s || '')
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .toLowerCase();
    }

    const animes = [
      {id:1, title:"DAN DA DAN", img:"dan.jpg", rating:4.9, genres:["Acci√≥n","Sh≈çnen","Sobrenatural","Comedia","Romance","Comedia oscura"]},
      {id:2, title:"Jujutsu Kaisen", img:"Jujutsu.jpg", rating:4.9, genres:["Sh≈çnen","Sobrenatural","Fantas√≠a oscura","Acci√≥n","Nekketsu"]},
      {id:3, title:"Konosuba", img:"https://www.dropbox.com/scl/fi/973zjlsi4a03w1hde7ivd/DrPytSFXgAYg1Z_-1.jpg?rlkey=wr2btn7cf7wp9yyt7id7uy9uy&st=gxhbfwyq&raw=1", rating:4.8, genres:["Aventura","Comedia","Fantas√≠a","Sobrenatural","Isekai","Ecchi","Sh≈çnen"]},
      {id:4, title:"Re:Zero ‚àí Empezar vida en otro mundo", img:"rezero.png", rating:4.8, genres:["Acci√≥n","Aventura","Drama","Fantas√≠a oscura","Romance","Thriller psicol√≥gico","Terror psicol√≥gico","Isekai","Sh≈çnen"]},
      {id:5, title:"Mushoku Tensei", img:"mushoku.jpg", rating:4.8, genres:["Isekai","Ecchi","Romance","Harem","Acci√≥n","Aventura","Drama","Fantas√≠a","Seinen"]},
      {id:6, title:"Tensei Shitara Slime Datta Ken", aliases: ["That Time I Got Reincarnated as a Slime"], img:"slime.jpg", rating:4.9, genres:["Comedia","Isekai","Acci√≥n","Aventura","Fantas√≠a"]},
      {id:7, title:"Saga of Tanya the Evil", aliases: ["Y≈çjo Senki"], img:"tanya1.jpg", rating:4.8, genres:["Acci√≥n","Aventura","Fantas√≠a","Militar","Drama","Ciencia ficci√≥n","Seinen"]},
      {id:8, title:"Akame Ga Kill", aliases: ["Akame ga Kiru"], img:"Akame1.jpg", rating:4.6, genres:["Acci√≥n","Aventura","Drama","Fantas√≠a oscura","Sh≈çnen","Romance","Tragedia"]},
      {id:9, title:"To Be Hero X", img:"hero11.jpg", rating:4.8, genres:["Acci√≥n","Comedia","Animaci√≥n","Fantas√≠a","Superh√©roes","Seinen"]},
      {id:10, title:"Demon Slayer", aliases: ["Kimetsu no Yaiba"], img:"demon.jpg", rating:4.9, genres:["Acci√≥n","Fantas√≠a oscura","Aventura","Sh≈çnen","Sobrenatural","Comedia","Drama"]},
      {id:11, title:"Maou 2099", img:"https://www.dropbox.com/scl/fi/su8i4y0cynftlnzlldfhj/maou2099-1.jpg?rlkey=4yg0msepo25lpn80kxg9ni3um&st=vdhrcc8y&raw=1", rating:4.7, genres:["Ciencia ficci√≥n","Isekai Inverso","Acci√≥n","Fantas√≠a","Cyberpunk"]},
      {id:12, title:"Wistoria: Wand and Sword", img:"wistoria.jpg", rating:4.8, genres:["Fantas√≠a","Aventura","Sh≈çnen"]},
      {id:13, title:"Izure Saikyou no Renkinjutsushi", aliases: ["Possibly the Greatest Alchemist of All Time"], img:"Izure.jpg", rating:4.6, genres:["Aventura","Comedia","Fantas√≠a","Isekai","Sh≈çnen"]},
      {id:14, title:"Alya Sometimes Hides Her Feelings in Russian", aliases: ["Tokidoki Bosotto Russia-go de Dereru Tonari no Alya-san"], img:"alia.jpg", rating:4.8, genres:["Comedia","Romance","Romance escolar","Escolar","Josei"]},
      {id:15, title:"Reborn as a Vending Machine, I Now Wander the Dungeon", aliases: ["Jid≈çhanbaiki ni Umarekawatta Ore wa Meiky≈´ ni Samay≈ç"], img:"jidou.jpg", rating:4.2, genres:["Fantas√≠a","Isekai","Sh≈çnen"]},
      {id:16, title:"kimi to boku no saigo no senjou", aliases: ["Our Last Crusade or the Rise of a New World"], img:"kimi22222.jpg", rating:4.5, genres:["Acci√≥n","Fantas√≠a","Romance","Militar","Seinen"]},
      {id:17, title:"The Gorilla God's Go- To Girl", aliases: ["Gorilla no Kami Kara Kago Sareta Reij≈ç wa ≈åritsu Kishidan de Kawaiigareru"], img:"gorila11.jpg", rating:4.5, genres:["Fantas√≠a","Comedia","Escolar","Romance","Sh≈çjo"]},
      {id:18, title:"Chainsaw Man", img:"chaiw11.jpg", rating:4.9, genres:["Fantas√≠a oscura","Acci√≥n","Sh≈çnen","Comedia oscura"]},
      {id:19, title:"The Rising of the Shield Hero", aliases: ["Tate no Yuusha no Nariagari","El H√©roe del Escudo"], img:"https://www.dropbox.com/scl/fi/qriw9hu1jsc46jh75xsgw/FqaFeK9XoAMW7_lg-1-1.jpg?rlkey=5516wyvugdk4y8kpflr49y5cr&st=2mq5x24h&raw=1", rating:4.7, genres:["Aventura","Drama","Fantas√≠a","Acci√≥n","Seinen","Romance","Isekai"]},
      {id:20, title:"Overflow", img:"overflow.jpg", rating:4.6, genres:["Hentai","Escolar","Romance","Harem","Incesto"]},
      {id:21, title:"Shiunji-ke no Kodomotachi", img:"Shiux.jpg", rating:4.6, genres:["Comedia","Romance","Drama","Harem","Slice of Life","Seinen"]},
      {id:22, title:"Goblin Slayer", img:"https://www.dropbox.com/scl/fi/ltdh8xylehw9b4p1gql9l/goblins-1-1.jpg?rlkey=glkiwc6kmlxkyt2htyxvawjaf&st=f4aqlj2g&raw=1", rating:4.7, genres:["Seinen","Fantas√≠a oscura","Horror","Aventura","Fantas√≠a"]},
      {id:23, title:"Kanchigai no Atelier Meister", img:"atelier1.jpg", rating:4.6, genres:["Aventura","Comedia","Fantas√≠a","Acci√≥n","Sh≈çnen"]},
      {id:24, title:"Definitivamente. ¬°No me gusta mi hermano para nada!", img:"Oni.jpg", rating:4.1, genres:["Seinen","Comedia","Romance","Slice of Life","Harem","Ecchi"]},
      {id:25, title:"Kaiju No. 8", img:"https://www.dropbox.com/scl/fi/ay1uv6tunghtxgty33kor/easgsdagsgd-1.jpg?rlkey=4o7rpeem4b4q1j3bvb5658qmr&st=dvv92bay&raw=1", rating:4.9, genres:["Sh≈çnen","Sobrenatural","Fantas√≠a oscura","Acci√≥n","Ciencia ficci√≥n","Aventura","Comedia","Kaiju"]},
      {id:26, title:"Zootopia", img:"https://www.dropbox.com/scl/fi/fqx51rdmzpzey4l5dswwv/zootopia.jpg?rlkey=52hnhfwz3pxr74564l5nzd6il&st=hiby8o0e&raw=1", rating:4.7, genres:["Aventura","Comedia","Crimen","Infantil","Familiar","Misterio","Animaci√≥n","Dibujo Animado"]},
      {id:27, title:"Clevatess -Majuu no Ou to Akago", img:"https://www.dropbox.com/scl/fi/znhu04opb4czg3o0m7dam/Clevatess-Majuu-no-Ou-to-Akago.jpg?rlkey=rsbqms1bnsx4nc80dgb6yme6k&st=y9r1feiz&raw=1", rating:4.8, genres:["Acci√≥n","Fantas√≠a","Drama"]},
      {id:28, title:"Dr. Stone", img:"https://www.dropbox.com/scl/fi/2z36rgoagk82dw2cb0lql/Dr._Stone_29_.jpg?rlkey=mqb5z6o7hj41ricpm6fnsm8hy&st=dh105dpx&raw=1", rating:4.8, genres:["Ciencia ficci√≥n","Aventura","Comedia","Sh≈çnen","Post-apocal√≠ptico"]},
      {id:29, title:"One Piece (Live Action)", img:"https://www.dropbox.com/scl/fi/50vo69ws4i64qv4kxibs7/oneeee.jpg?rlkey=ok8a8nt6bh8g0rzzpqisptfoe&st=psff3vov&raw=1", rating:4.8, genres:["Aventura","Comedia","Acci√≥n","Fantas√≠a","Drama"]},
      {id:30, title:"Shoujo Ramune", img:"https://www.dropbox.com/scl/fi/ok7pcimnqtue7gg30i70x/shoujo.jpg?rlkey=sl1bn5cj5bmxu003jq2q6906d&st=fd15ap5n&raw=1", rating:4.3, genres:["Hentai","Harem","Incesto"]},
      {id:31, title:"To Your Eternity", aliases: ["Fumetsu no Anata e"], img:"https://www.dropbox.com/scl/fi/du5sn8bt3ie6l4odbsjo6/fumetsu-1.jpg?rlkey=jx3a1v76k20ki639pmwe9v9b3&st=rawxrnvg&raw=1", rating:4.8, genres:["Fantas√≠a","Drama","Aventura","Sh≈çnen","Sobrenatural"]},
      {id:32, title:"Tsugunai Subbed", img:"https://www.dropbox.com/scl/fi/hkyj8asfbi0lw4kyuzjvk/71Bk-zdlprL-1.jpg?rlkey=g875hho1bd55nyaqo4p2hh9ek&st=gahfap3z&raw=1", rating:4.8, genres:["Hentai","Harem","Escolar"]},
      {id:37, title:"Shinsei Kourin Dacryon Luna", img:"https://www.dropbox.com/scl/fi/f3ada5jvt69z0si1f82eo/portadah.jpg?rlkey=l6y1gyidiucos6j2g1gjyp7k3&st=82m33282&raw=1", rating:4.0, genres:["Tent√°culos","Hentai","Fantas√≠a","Seinen","Fantas√≠a oscura"]},
    ];


  function debounce(fn, wait) {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => fn(...args), wait);
    };
  }
  const debouncedFiltro = debounce(filtro, 200);

  function render(list) {
    const grid = document.getElementById('grid');
    grid.innerHTML = list.map(a => `
      <div class="card" onclick="location='anime-detail.html?id=${a.id}'">
        <img src="${a.img}" alt="${a.title}">
        <div class="info">
          <strong>${a.title}</strong>
          <span>‚≠ê ${a.rating.toFixed(1)}</span>
        </div>
      </div>
    `).join('');
    const observer = new IntersectionObserver(entries => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('visible');
          observer.unobserve(e.target);
        }
      });
    }, {threshold:0.2});
    document.querySelectorAll('.card').forEach(c => observer.observe(c));
  }

    function filtro(){
      const qRaw   = document.getElementById('search').value || '';
      const q = qRaw.trim();
      const qn = normalizeText(q);
      const g   = document.getElementById('genre-select').value;
      const cat = document.getElementById('rating-select').value;

      const filtrados = animes.filter(a => {
        // preparar lista de strings buscables: titulo + aliases
        const titles = [a.title].concat(a.aliases || []);
        // NORMALIZADO: ahora usamos startsWith (prefijo) para respetar orden de letras
        const matchesText = !qn || titles.some(t => normalizeText(t).startsWith(qn));
        const byGenre  = !g || a.genres.includes(g);
        let byRating = true;
        if(cat==='excellent') byRating = a.rating >= 4.8;
        else if(cat==='good')    byRating = a.rating >= 4.6 && a.rating < 4.8;
        else if(cat==='regular') byRating = a.rating < 4.6;
        return matchesText && byGenre && byRating;
      });
      render(filtrados);
    }

  // Funci√≥n para barajar (Fisher-Yates)
  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  // Barajar el arreglo al cargar la p√°gina para que cada carga tenga un orden distinto
  shuffleArray(animes);

  // Render inicial
  render(animes);

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Cambiar header al hacer scroll ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  window.addEventListener('scroll', () => {
    document.querySelector('header')
      .classList.toggle('scrolled', window.scrollY > 50);
  });

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Enlazar b√∫squeda al debounce ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  document.getElementById('search')
          .addEventListener('input', debouncedFiltro);
  document.getElementById('genre-select')
          .addEventListener('change', filtro);
  document.getElementById('rating-select')
          .addEventListener('change', filtro);
</script>
</body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        